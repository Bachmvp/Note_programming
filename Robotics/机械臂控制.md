# 机械臂控制

在做对四足机器人的控制的调研时，又看到了PD控制器，所以打算重新复习一下第一学期的机器人工程中对机械臂的控制。

在那门课中，项目是关于机械臂的控制。

## 建模

首先是建模，最开始是较为简单的运动学建模，也就是不考虑力和力矩，只考虑位置，速度和加速度的控制。也就是输入电压->角加速度，角速度，角位置

![](C:\Users\DLSH\git_note_programming\Robotics\PD_motormodel.PNG)

**这就是直流电机的模型，输入位电压u，tau就是减速器另一侧的负载力矩，其实就是干扰。**

**比较重要的模型参数就是JM和fM。JM是电机的惯性量，而fM是电机的黏性摩擦系数。**

<img src="C:\Users\DLSH\git_note_programming\Robotics\motorgear.PNG" style="zoom:30%;" />

**这里的JM=Ja+Jg, Ja是电机的惯量，Jg是齿轮的惯量。**

**所以建模的第一步就是先把这些参数求出来**

<img src="C:\Users\DLSH\git_note_programming\Robotics\PD_motormodelparam1.PNG" style="zoom:50%;" />

<img src="C:\Users\DLSH\git_note_programming\Robotics\PD_motormodelparam2.PNG" style="zoom:50%;" />

**这里的Jeff被称为有效惯量，我认为是这里的JM包含了Ja+Jg,然后第一项由于使用了n，也就是减速比，那么肯定与负载侧有关，而这个Dq又是从动力学方程得来的**

![](C:\Users\DLSH\git_note_programming\Robotics\dynamics.PNG)

**可以看出这就是动力学方程推导出来的，可以看出来这里的惯性量考虑了电机，齿轮和负载**

![](C:\Users\DLSH\git_note_programming\Robotics\PD_motormodelparam3.PNG)

**fL=0;**

**这里就是求电机的黏性摩擦系数，但这里就不考虑负载了。**

## 控制

在有了电机模型之后，就可以设计控制器了，首先这里是独立控制，是比较偷懒但是实用性比较高的控制模式，以机械臂为例子，给定目标位置点，通过逆运动学进行解算，计算出每个电机需要旋转的角度，然后分别进行控制，但因为电机和关节之间还会有相互作用，这部分被作为干扰来处理。

这种控制方法一般会采用PD控制或者PID控制，这里可能有一个疑问，为什么是PD？按说PI是最通用的控制器才对，其实是因为，这里的电机模型和PD控制器一起构成的闭环系统正好是一个二阶系统，而PD控制器的两个参数又可以通过调节去影响阻尼比和频率从而调节特征根达到临界阻尼，也就是最好效果，所以PD控制器被使用。这和在柔性控制器对一般的机械被控模型，弹簧阻尼模型很像，也是用PD控制器一起构成二阶系统。

这篇文章对PID控制的描述非常好：https://zhuanlan.zhihu.com/p/147800110

在这篇文章中我也回想起了在鲁棒控制那门课中学习的最关键的部分，就是使用传递函数表示灵敏度，开环系统，闭环系统，这是非常重要的，因为在框图中我们可以使用传递函数描述我们想要看的某项对某项的影响，比如：输入到输出，干扰到输出，噪音到输出，或者到误差等的传递函数，然后通过伯德图就可以看到低频和高频下的幅值，就可以理解当前的控制系统是否抗干扰，是否抗噪音，是否跟随输入等。

然后就是PD和PID控制肯定可以在一定程度上抗干扰，或者说是可以抵抗不变的干扰值，这里可能我们可以通过调大参数，比如KP来无限缩小这个误差或者干扰造成的影响，但是首先就是饱和性，参数过大是不可能的。第二个就是柔软性，这种对目标的硬邦邦的控制没有柔性，比如共振造成的影响。



但对于时变的干扰来说，完全的抗干扰是不可能的，这个时候就想到了古典控制中经常提到的前馈控制，一个非常重要的辅助控制，在机器人的控制中也经常使用，前馈控制可以理解为我们经常在现代控制中，比如MPC，我们会在每一次控制前拿到干扰值，然后补到模型里去，这里的前馈是一个意思，他通过古典控制的方法，需要知道被控系统的模型和干扰值，然后前馈直接把相应的干扰值会引起的对输出的影响所对应的输出值求出来，然后减去，其实就是抵消掉干扰的影响。这是通过前馈抗干扰的方面，前馈还有可以帮助追踪目标的功能，前馈项可以理解为产生跟踪期望轨迹的力，让响应变得更快。总结下来可以表示为u = f(d)+f(r).

然后关于f(r),在机器人控制的书中有一个例子，就是其实如果被控系统的模型是理想的G（s），并且是最小相位的，也就是零点都为负（为了让反馈控制器是稳定的），那么我们完全可以不使用反馈控制，直接前馈控制1/G(s).这样直接输入和目标相同。但真实里面肯定是不可能是理想的，所以需要加入反馈控制器调节，但主要的部分前馈干就可以了，所以这样响应速度会很快。

 下面引入动力学方程，在之前我们都是使用的运动学方程

![](C:\Users\DLSH\git_note_programming\Robotics\dynamics2.PNG)

**至于为什么导入动力学方程，原因肯定是为了得到更好的被控模型，使控制的更准确，因为之前我们虽然想加入前馈控制，但其实并不知道干扰是什么，这个干扰的建模就可以通过动力学建模得到。那么动力学如何和运动学结合呢？**

![](C:\Users\DLSH\git_note_programming\Robotics\dynamics3.PNG)

**公式中有一个g(q)是必须补偿的重力项，仅仅使用PD控制是无法保证系统实现渐进跟踪的，会出现稳态误差**

![](C:\Users\DLSH\git_note_programming\Robotics\dynamics4.PNG)

**到目前为止，我们还是在独立控制，只不过是通过动力学来尽量补偿不准确的地方**

### 力控

接下来会扩展到力控，力控首先与前面不同的是加入了和环境之间的交互项，所以传感器也增加了，比如力矩，压感的传感肯定是要有的。除此之外，考虑力一定是是要动力学模型

![](C:\Users\DLSH\git_note_programming\Robotics\torquecontrol.PNG)

可以看出来相比之前加入的动力学模型，增加了一项末端执行器的反作用力矩



**PS：在我们那门课程的项目中，老师给了我们动力学方程的参数，也就是Dq cq gq。关于gq也就是重力项，是作为干扰在仿真测试中进行的，当时因为不理解这里并没有进行补偿，其实既然知道了干扰值，完全是可以进行补偿的，也就是PD控制器也可以达到0稳态误差的。**